<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
		/>
		<title>{{ spa.name }} Reviews</title>
		<link
			href="{{ url_for('static', filename='css/reviews.css')}}"
			rel="stylesheet"
		/>
		<link
			rel="icon"
			href="{{ url_for('static', filename='img/favicon.png')}}"
			type="image/png"
		/>
	</head>
	<body class="p-3">
		<main class="container">
			<!-- Navigation Bar -->
			<nav class="navbar navbar-expand-lg navbar-light mb-4">
				<div class="container-fluid">
					<a
						class="navbar-brand"
						href="{{ url_for('profile.spa_profile', spa_id=spa.id) }}"
						style="color: palevioletred"
					>
						<i class="bi bi-arrow-left"></i> Back to Profile
					</a>
					<div class="d-flex">
						<a
							href="{{ url_for('location.spa_location', spa_id=spa.id) }}"
							class="btn btn-outline-primary me-2"
							style="color: palevioletred; border-color: palevioletred"
						>
							<i class="bi bi-geo-alt"></i> Location
						</a>
						<a
							href="{{ url_for('booking.book_spa', spa_id=spa.id) }}"
							class="btn btn-primary btn spa-btn"
						>
							<i class="bi bi-calendar-check"></i> Book Now
						</a>
					</div>
				</div>
			</nav>
			<!-- Page Header -->
			<div class="d-flex justify-content-between align-items-center mb-4">
				<h1 class="spa-header mb-0">
					<i class="bi bi-chat-square-text me-2"></i>{{ spa.name }} Reviews
				</h1>
				<button
					class="btn spa-btn"
					id="addReviewBtn"
					data-bs-toggle="modal"
					data-bs-target="#reviewModal"
				>
					<i class="bi bi-plus-circle me-2"></i>Add Review
				</button>
			</div>

			<!-- Reviews List -->
			<div class="mb-5" id="reviewsContainer">
				{% if spa.reviews %} {% for review in spa.reviews %}
				<div class="card review-card mb-3">
					<div class="card-body">
						<div class="d-flex align-items-center mb-3">
							<div>
								<h5 class="mb-0">{{ review.customer_name }}</h5>
								<div class="rating small">
									{% for i in range(1,6) %}
									<i
										class="bi bi-star{{ '-fill' if i <= review.rating else '' }}"
									></i>
									{% endfor %}
									<span class="ms-2 text-muted"
										>{{ review.created_at|datetimeformat }}</span
									>
								</div>
							</div>
						</div>
						<p class="mb-3">{{ review.comment }}</p>
						{% if review.images %}
						<div class="review-images mt-3">
							<div class="d-flex flex-wrap gap-2">
								{% for image in review.images %}
								<img
									src="{{ url_for('static', filename=image.filepath) }}"
									class="img-thumbnail"
									style="
										width: 80px;
										height: 80px;
										object-fit: cover;
										cursor: pointer;
									"
									data-bs-toggle="modal"
									data-bs-target="#imageModal"
									data-image="{{ url_for('static', filename=image.filepath) }}"
									alt="Review image"
								/>
								{% endfor %}
							</div>
						</div>
						{% endif %}
					</div>
				</div>
				{% endfor %} {% else %}
				<div class="text-center py-4">
					<i
						class="bi bi-chat-square-text"
						style="font-size: 2rem; color: palevioletred"
					></i>
					<h4 class="mt-3">No reviews yet</h4>
					<p>Be the first to review {{ spa.name }}</p>
				</div>
				{% endif %}
			</div>

			<!-- Review Modal -->
			<div class="modal fade" id="reviewModal" tabindex="-1" aria-hidden="true">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title spa-header">
								Write a Review for {{ spa.name }}
							</h5>
							<button
								type="button"
								class="btn-close"
								data-bs-dismiss="modal"
								aria-label="Close"
							></button>
						</div>
						<div class="modal-body">
							<form id="reviewForm" enctype="multipart/form-data">
								<input type="hidden" name="spa_id" value="{{ spa.id }}" />
								<div class="mb-4">
									<label class="form-label">Your Rating</label>
									<div
										class="rating mb-2"
										id="ratingStars"
										style="font-size: 28px"
									>
										{% for i in range(1,6) %}
										<i class="bi bi-star" data-value="{{ i }}"></i>
										{% endfor %}
										<input
											type="hidden"
											id="ratingValue"
											name="rating"
											value="0"
										/>
									</div>
								</div>
								<div class="mb-3">
									<label for="reviewText" class="form-label">Your Review</label>
									<textarea
										class="form-control"
										id="reviewText"
										name="comment"
										rows="5"
										required
									></textarea>
								</div>
								<div class="mb-3">
									<label for="reviewImages" class="form-label"
										>Upload Photos (Optional)</label
									>
									<input
										type="file"
										class="form-control"
										id="reviewImages"
										name="review_images"
										multiple
										accept="image/*"
									/>
									<div class="form-text">
										You can upload up to 5 images. Supported formats: JPG, PNG,
										GIF
									</div>
								</div>
								<div
									id="imagePreview"
									class="mb-3 d-flex flex-wrap gap-2"
									style="display: none !important"
								></div>
								<div class="d-flex justify-content-end gap-2 mt-4">
									<button
										type="button"
										class="btn btn-outline-secondary"
										data-bs-dismiss="modal"
									>
										Cancel
									</button>
									<button type="submit" class="btn spa-btn">
										Submit Review
									</button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
			<!-- Image View Modal -->
			<div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Review Photo</h5>
							<button
								type="button"
								class="btn-close"
								data-bs-dismiss="modal"
								aria-label="Close"
							></button>
						</div>
						<div class="modal-body text-center">
							<img
								id="modalImage"
								src=""
								class="img-fluid"
								alt="Review photo"
							/>
						</div>
					</div>
				</div>
			</div>
		</main>
		<script src="{{ url_for('static', filename='js/spa_reviews/reviews_ui.js')}}"></script>
		<script src="{{ url_for('static', filename='js/spa_reviews/reviews_images.js')}}"></script>
		<script src="{{ url_for('static', filename='js/spa_reviews/reviews_auth.js')}}"></script>
		<script src="{{ url_for('static', filename='js/spa_reviews/reviews_load.js')}}"></script>
		<script src="{{ url_for('static', filename='js/spa_reviews/reviews_submit.js')}}"></script>
		<script src="{{ url_for('static', filename='js/spa_reviews/reviews_main.js')}}"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
	</body>
</html>
